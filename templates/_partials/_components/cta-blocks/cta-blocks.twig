{# @var craft \craft\web\twig\variables\CraftVariable #}
{# @var entry \craft\elements\Entry #}
{# ======================================================
  @filename: cta-blocks
  @date:     09 jul. 2020
  @author:   sam
  ====================================================== #}
{#
  Max of 3 blocks
#}

{% import "_partials/_macros.twig" as macro %}
{# uncomment line above if you need to use macros in your template #}

{% set intro = intro is defined ? intro : '' %}
{% set class = class is defined ? class : '' %}
{% set blocks = blocks is defined ? blocks : '' %}
{% set blocksEntries = blocksEntries is defined ? blocksEntries : false %}
{% set customCtaLabel = customCtaLabel is defined ? customCtaLabel : '' %}
{% set ctaArrows = ctaArrows is defined ? ctaArrows : false %}
{% set swiper = swiper is defined ? swiper : true %}
{% set uniqueId = blocks['id'] is defined and blocks.id | length ? blocks.id : random() %}

{% if blocks | length %}
  <div class="container">
    <div class="row">
      <div class="col-12">
        {% if intro | length %}
          <div>
            {{ intro }}
          </div>
        {% endif %}

        {% if swiper %}
        <div class="swiper">
          <div class="c-cta-blocks {{ class }} swiper-container js-cta-blocks js-swiper-destroy"
               data-swiper-id="{{ uniqueId }}">
            <div class="swiper-wrapper">
              {% else %}
              <div class="c-cta-blocks {{ class }}">
                {% endif %}

                {% for block in blocks %}
                  {% if blocksEntries %}
                    {% include '_partials/_components/cta-blocks/cta-block/cta-block.twig' with {
                      title: block.title,
                      mainImage: block['headerImage'] is defined and block.headerImage | length ? block.headerImage.one() : '',
                      subContent: block['summaryText'] is defined and block.summaryText | length ? block.summaryText : '',
                      cta: { url: block.url, text: customCtaLabel | length ? customCtaLabel : 'Lees meer', target: '' },
                      swiper: swiper,
                      ctaArrow: ctaArrows,
                    } %}
                  {% else %}
                    {% if customCtaLabel | length %}
                      {% set cta = block.cta | merge ({ text: customCtaLabel }) %}
                    {% else %}
                      {% set cta = block.cta %}
                    {% endif %}

                    {% if block.mainContent[0].type == 'image' %}
                      {% include '_partials/_components/cta-blocks/cta-block/cta-block.twig' with {
                        title: block.heading,
                        subTitle: block.subHeading,
                        mainImage: block.mainContent[0].image.one(),
                        subContent: block.usps,
                        cta: cta,
                        ctaArrow: ctaArrows,
                        swiper: swiper
                      } %}
                    {% else %}
                      {% include '_partials/_components/cta-blocks/cta-block/cta-block.twig' with {
                        title: block.heading,
                        subTitle: block.subHeading,
                        mainTitle: block.mainContent[0].heading,
                        mainSubTitle: block.mainContent[0].subHeading,
                        subContent: block.subContent,
                        cta: cta,
                        ctaArrow: ctaArrows,
                        swiper: swiper
                      } %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
                {% if swiper %}
              </div>
            </div>
            <div class="swiper-pagination" data-swiper-id="{{ uniqueId }}">
            </div>
            {% else %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endif %}
