{# @var craft \craft\web\twig\variables\CraftVariable #}
{# @var entry \craft\elements\Entry #}
{# ======================================================
  @filename: overview
  @author:   sam
  ====================================================== #}
{#
  Overview for news items
#}

{# {% import "_partials/_macros.twig" as macro %} #}
{% extends (craft.app.request.isAjax) ? "_layouts/_ajax.twig" : "_layouts/_layout.twig" %}

{% block _inline_css %}
  {% if not craft.app.request.isAjax %}
    <style>
      {{ source ("index_critical.min.css", ignore_missing = true) }}
    </style>
  {% endif %}
{% endblock %}

{% block content %}
  {% set searchQuery = craft.app.request.getQueryParam('q') | length ? craft.app.request.getQueryParam('q') : '' %}

  {# ----------- Start - No ajax request ----------- #}
  {% if not craft.app.request.isAjax %}
    {% set entry = entry is defined ? entry : category %}

  {% include '_partials/_global/header' with {
    title: entry.title,
    image: entry.headerImage.one(),
    intro: entry.intro
  } %}
<div class="bg-teal-100 pt-6">
  <div class="container">

    {# Search #}
    <form class="js-load-more-search-form c-form-search" method="post">
      <span class="js-load-more-search-url d-none" data-url="{{ entry.url }}"></span>
      <label id='search-label' for="search" class="d-none">Zoeken</label>
      <input id="search" type="search" class="js-load-more-search-input" aria-labelledby="search-label" name="q" placeholder="{{ "Zoeken..."|t }}"
             {% if searchQuery | length %}value="{{ searchQuery }}{% endif %}">
      <button class="c-form-search__button c-btn" type="submit">
        <span class="c-form-search__button__search">
          {% include '_inline/_svg/search-regular.twig' %}
        </span>
        <span class="c-form-search__button__label">{{ 'Zoeken' | t }}</span>
        <span class="c-form-search__button__loader">
          {% include '_inline/_svg/loading.twig' %}
        </span>
      </button>
    </form>
    {% set entriesLength = craft.entries.section('newsItems') | length %}
    {% set overviewPage = craft.entries.section('newsOverview')[0] %}

    <div class="d-flex flex-column flex-lg-row">
      {% endif %}
  {# ----------- End - No ajax request ----------- #}

      {% set items = craft.entries({
        section: 'newsItems',
        search: searchQuery,
        with: (['headerImage'])
      }) %}

  {# ----------- Start - No ajax request ----------- #}
      {% if not craft.app.request.isAjax %}
      {% set foundAmount = items | length %}

      <div class="w-100 flex-grow-1 mt-4">
        {% if searchQuery | length %}
          {% if items | length %}
            <p>{{ foundAmount }} resultaten gevonden voor <span class="weight-700">"{{ searchQuery }}"</span></p>
          {% else %}
            <p>Geen resultaten gevonden voor <span class="weight-700">"{{ searchQuery }}"</span></p>
          {% endif %}
        {% endif %}

        {# Wrapper that is used for js ajax #}
        <div class="js-load-more-wrapper w-100">
          {% endif %}
  {# ----------- End - No ajax request ----------- #}

          {% paginate items.limit(2).orderBy('postDate asc') as pageInfo, entries %}

          {% if entries | length %}
            <div class="d-flex flex-column">
              {% for item in entries %}
                {% include '_partials/_components/card/card.twig' with {
                  url: item.url,
                  image: item.headerImage[0],
                  title: item.title,
                  date: item.dateCreated,
                  summary: (item.summaryText|striptags[:40] ~ '...'),
                } %}
              {% endfor %}
            </div>
          {% endif %}

          {# Url of next page and ajax call #}
          <span class="js-load-more-next-page" data-next-page="{{ pageInfo.nextUrl }}"></span>

  {# ----------- Start - No ajax request ----------- #}
          {% if not craft.app.request.isAjax %}
        </div>
        <div class="d-flex justify-content-center mt-4 mb-4">
          <a class="c-btn js-load-more-button hide" href="" title="Bekijk meer items">
            <span>Meer nieuws</span>
            <span>
              {% include '_inline/_svg/loading.twig' %}
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  {# ----------- End - No ajax request ----------- #}

  {% endblock %}

  {% block _inline_js %}
  {% endblock %}
